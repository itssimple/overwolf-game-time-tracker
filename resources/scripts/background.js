var firstLaunch=!0,mainWindowId=null,gameDetector=null;function openWindow(n,o){n&&log("[WINDOW]","Got launch event: ",n),n&&"overwolfstartlaunchevent"==n.origin||overwolf.windows.obtainDeclaredWindow("mainWindow",e=>{e.success&&(mainWindowId=e.window.id,overwolf.windows.restore(e.window.id),log("[WINDOW]",`Opening window. Reason: ${o}`,n))})}var backgroundGameUpdater=null;function gameLaunched(e){e&&(window.possibleGameName&&null!=window.possibleGameName&&(e.title=window.possibleGameName,log("[GAME:TITLE]","Custom title",e.title)),log("[GAME:LAUNCH]",e),eventEmitter.emit("game-launched",e),backgroundGameUpdater=setInterval(function(){window.db.updateGameSessionBySessionId(e.sessionId,{endDate:Date.now()})},1e4))}function gameInfoUpdated(e){e&&e.gameInfo&&!e.gameInfo.isRunning&&e.runningChanged&&(log("[GAME:UPDATE]",e),eventEmitter.emit("game-exited",e),clearInterval(backgroundGameUpdater),backgroundGameUpdater=null)}function launcherInfoUpdates(e){if(e&&e.launcherClassId&&10902==e.launcherClassId&&e.feature&&"lobby_info"==e.feature&&e.info&&e.info.lobby_info&&e.info.lobby_info.queueId)switch(e.info.lobby_info.queueId){case"1090":case"1100":case"1130":window.possibleGameName="Teamfight Tactics";break;default:window.possibleGameName=null}}function setLauncherEvents(n){overwolf.games.launchers.events.setRequiredFeatures(10902,["lobby_info"],function(e){"error"!=e.status?(log("[LOL-LAUNCHER]",e),n&&n(e)):setTimeout(function(){setLauncherEvents(n)},2e3)})}function onLauncherLaunched(e){log("[GAME:LAUNCHER]",e),10902==e.classId&&setLauncherEvents()}function onLauncherTerminated(e){log("[GAME:LAUNCHER]",e),window.possibleGameName=null}window.possibleGameName=null,firstLaunch&&(log("[INIT]","Initializing all event handlers and getting all the recently played games (to see if we missed anything)"),window.eventEmitter||(window.eventEmitter=new EventEmitter),window.db||(log("[DATABASE]","Initializing database"),window.db=new GameTimeTrackerDatabase,db.initializeDatabase(function(){location.search.indexOf("overwolfstartlaunchevent")&&window.db.getUnfinishedSessions(function(e){if(e&&0<e.length){log("[SESSION:CLEANUP]",`Found ${e.length} unfinished sessions to fix.`);for(var n of e)log("[SESSION:CLEANUP]","Unfinished session",n),n.endDate=n.startDate+6e4,window.db.updateGameSessionBySessionId(n.sessionId,n,function(){window.eventEmitter.emit("reload-window","mainWindow")});overwolf.games.getRunningGameInfo(function(e){e||window.eventEmitter.emit("shutdown",null)})}}),log("[GAMEDETECTOR]","Initializing GameDetector plugin"),overwolf.extensions.current.getExtraObject("game-detector",e=>{"success"==e.status&&(gameDetector=e.object).LoadGameDBData(function(e){log("[GAMEDETECTOR]","Loaded data from server",e)})}),log("[DATABASE]","Done initializing the database"),log("[INIT:LAUNCHREASON]",location.search),-1<location.search.indexOf("-from-desktop")||-1<location.search.indexOf("source=commandline")||-1<location.search.indexOf("source=dock")||-1<location.search.indexOf("source=storeapi")||-1<location.search.indexOf("source=odk")||-1<location.search.indexOf("source=after-install")||-1<location.search.indexOf("source=tray")?openWindow(null,location.search):location.search.indexOf("source=gamelaunchevent")&&(log("[GAME:LAUNCH]","Application was started by game"),overwolf.games.getRunningGameInfo(function(e){e?gameLaunched(e):window.eventEmitter.emit("shutdown",null)})),history.replaceState({},window.title,location.href.replace(location.search,""))})),firstLaunch=!1,overwolf.extensions.onAppLaunchTriggered.removeListener(openWindow),overwolf.extensions.onAppLaunchTriggered.addListener(openWindow),overwolf.games.onGameLaunched.removeListener(gameLaunched),overwolf.games.onGameLaunched.addListener(gameLaunched),overwolf.games.onGameInfoUpdated.removeListener(gameInfoUpdated),overwolf.games.onGameInfoUpdated.addListener(gameInfoUpdated),overwolf.games.launchers.events.onInfoUpdates.removeListener(launcherInfoUpdates),overwolf.games.launchers.events.onInfoUpdates.addListener(launcherInfoUpdates),overwolf.games.launchers.onLaunched.removeListener(onLauncherLaunched),overwolf.games.launchers.onLaunched.addListener(onLauncherLaunched),overwolf.games.launchers.onTerminated.removeListener(onLauncherTerminated),overwolf.games.launchers.onTerminated.addListener(onLauncherTerminated),overwolf.games.launchers.getRunningLaunchersInfo(function(n){if(n&&n.success&&0<n.launchers.length)for(var e of n.launchers)10902==e.classId&&setLauncherEvents(function(e){overwolf.games.launchers.events.getInfo(10902,function(e){launcherInfoUpdates({launcherClassId:n.launchers[0].classId,feature:"lobby_info",info:{lobby_info:{queueId:e.res.lobby_info.queueId}}})})})}),window.eventEmitter.addEventListener("game-launched",function(e){db.newGameSession(e)}),window.eventEmitter.addEventListener("game-exited",function(e){db.updateGameSession(e),mainWindowId?overwolf.windows.getWindowState(mainWindowId,function(e){!e.success||"closed"!=e.window_state_ex&&"hidden"!=e.window_state_ex||window.eventEmitter.emit("shutdown",null)}):window.eventEmitter.emit("shutdown",null)}),window.eventEmitter.addEventListener("shutdown",function(){log("[EXIT]","Got told to exit the application, doing that!"),overwolf.windows.getCurrentWindow(function(e){overwolf.windows.close(e.window.id,function(){})})}),log("[INIT]","All eventhandlers have been set"));